# 默认配置（开发环境）
replicaCount: 1

image:
  registry: harbor.example.com
  prefix: flashsale
  pullPolicy: IfNotPresent
  tag: "latest"

imagePullSecrets:
  - name: harbor-secret

env: dev

# 服务配置
services:
  usercenterApi:
    enabled: true
    name: usercenter-api
    port: 1004
    metricsPort: 4008

  usercenterRpc:
    enabled: true
    name: usercenter-rpc
    port: 2004
    metricsPort: 4009

  travelApi:
    enabled: true
    name: travel-api
    port: 1003
    metricsPort: 4006

  travelRpc:
    enabled: true
    name: travel-rpc
    port: 2003
    metricsPort: 4007

  orderApi:
    enabled: true
    name: order-api
    port: 1001
    metricsPort: 4001

  orderRpc:
    enabled: true
    name: order-rpc
    port: 2001
    metricsPort: 4002

  orderMq:
    enabled: true
    name: order-mq
    metricsPort: 4003

  paymentApi:
    enabled: true
    name: payment-api
    port: 1002
    metricsPort: 4004

  paymentRpc:
    enabled: true
    name: payment-rpc
    port: 2002
    metricsPort: 4005

  mqueueJob:
    enabled: true
    name: mqueue-job
    metricsPort: 4010

  mqueueScheduler:
    enabled: true
    name: mqueue-scheduler
    metricsPort: 4011

# 资源限制
resources:
  api:
    limits:
      cpu: 1000m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  rpc:
    limits:
      cpu: 1000m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  mq:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi

# 探针配置
livenessProbe:
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# HPA 配置
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Ingress 配置
ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
    - host: api.flashsale.com
      paths:
        - path: /usercenter
          pathType: Prefix
          service: usercenter-api
        - path: /travel
          pathType: Prefix
          service: travel-api
        - path: /order
          pathType: Prefix
          service: order-api
        - path: /payment
          pathType: Prefix
          service: payment-api
  tls:
    - secretName: flashsale-tls
      hosts:
        - api.flashsale.com

# ConfigMap 配置
config:
  mysql:
    host: mysql.flashsale.svc.cluster.local
    port: 3306
  redis:
    host: redis.flashsale.svc.cluster.local
    port: 6379
  kafka:
    brokers: kafka.flashsale.svc.cluster.local:9092
  jaeger:
    endpoint: http://jaeger-collector.observability.svc.cluster.local:14268/api/traces

# Secret 配置（实际使用时应该用外部 Secret）
secrets:
  mysql:
    password: ""  # 从 K8s Secret 注入
  redis:
    password: ""  # 从 K8s Secret 注入
  jwt:
    secret: ""    # 从 K8s Secret 注入
  wechat:
    appId: ""
    appSecret: ""
    mchId: ""
    apiKey: ""

# ServiceMonitor 配置（Prometheus Operator）
serviceMonitor:
  enabled: true
  interval: 30s
  scrapeTimeout: 10s

# Pod 注解
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "metrics"

# 节点亲和性
nodeSelector: {}

tolerations: []

affinity: {}

# PodDisruptionBudget
podDisruptionBudget:
  enabled: false
  minAvailable: 1
